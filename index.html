<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üåä OpenFloodAI ‚Äî Multi-Region Flood Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; background: #e6f0ff; color: #333; margin: 0; padding: 0; }
    header { background: #0077cc; color: white; padding: 15px 20px; display: flex; align-items: center; }
    header img { height: 40px; margin-right: 10px; }
    h1 { font-size: 1.8em; margin: 0; }
    main { padding: 20px; }
    select { padding: 6px; margin: 5px; font-size: 1em; }
    .region-card {
      border: 1px solid #ccc; border-radius: 5px; padding: 10px; margin: 10px 0;
    }
    .RED { background: #ff9999; }
    .AMBER { background: #ffdb66; }
    .GREEN { background: #a8f0a5; }
  </style>
</head>

<body>
  <header>
    <img src="logo.svg" alt="OpenFloodAI logo">
    <h1>OpenFloodAI Dashboard</h1>
  </header>

  <main>
    <label for="countrySelect">üåç Country:</label>
    <select id="countrySelect"></select>

    <label for="regionSelect">üìç Region:</label>
    <select id="regionSelect">
      <option value="all">All Regions</option>
    </select>

    <div id="forecastContainer">
      <p>Loading forecast data...</p>
    </div>
  </main>

  <footer>
    <p style="text-align:center; padding: 10px; background: #0077cc; color: white;">
      OpenFloodAI ‚Äî Open-source community flood forecasting.
    </p>
  </footer>

  <script>
    async function loadForecastData() {
      try {
        const response = await fetch('data/outputs/all_forecasts.json');
        const data = await response.json();

        const forecasts = data.forecasts || {};
        const countries = {};
        
        // Organize forecasts by country ‚Üí region
        Object.keys(forecasts).forEach(key => {
          const [country, region] = key.split(':').map(s => s.trim());
          if (!countries[country]) countries[country] = [];
          countries[country].push(region);
        });

        const countrySelect = document.getElementById('countrySelect');
        const regionSelect = document.getElementById('regionSelect');
        const container = document.getElementById('forecastContainer');

        // Populate country dropdown
        countrySelect.innerHTML = '<option value="">Select a country</option>';
        Object.keys(countries).forEach(country => {
          const opt = document.createElement('option');
          opt.value = country;
          opt.textContent = country;
          countrySelect.appendChild(opt);
        });

        function showForecasts(country, regionFilter = "all") {
          container.innerHTML = "";
          Object.entries(forecasts).forEach(([key, values]) => {
            const [c, r] = key.split(':').map(s => s.trim());
            if (country && c !== country) return;
            if (regionFilter !== "all" && r !== regionFilter) return;

            const card = document.createElement('div');
            card.className = `region-card ${values.tier}`;
            card.innerHTML = `
              <strong>${r}</strong> ‚Äî <em>${c}</em><br>
              Flood Probability: <b>${values.P_final}</b><br>
              Tier: <b>${values.tier}</b><br>
              Rainfall (24h): ${values.radar_24h_accum} mm<br>
              Tide Height: ${values.tide_height} m
            `;
            container.appendChild(card);
          });
        }

        // On country change ‚Üí update regions
        countrySelect.addEventListener('change', () => {
          const selectedCountry = countrySelect.value;
          const regions = countries[selectedCountry] || [];

          regionSelect.innerHTML = '<option value="all">All Regions</option>';
          regions.forEach(region => {
            const opt = document.createElement('option');
            opt.value = region;
            opt.textContent = region;
            regionSelect.appendChild(opt);
          });

          showForecasts(selectedCountry, "all");
        });

        // On region change ‚Üí filter display
        regionSelect.addEventListener('change', () => {
          const selectedCountry = countrySelect.value;
          const selectedRegion = regionSelect.value;
          showForecasts(selectedCountry, selectedRegion);
        });

      } catch (error) {
        document.getElementById('forecastContainer').innerHTML =
          `<p style="color:red;">‚ö†Ô∏è Error loading forecast data.</p>`;
        console.error("Error loading data:", error);
      }
    }

    loadForecastData();
  </script>
</body>
</html>
